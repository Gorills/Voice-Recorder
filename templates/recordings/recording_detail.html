{% extends 'base.html' %}

{% block title %}{{ recording.title }}{% endblock %}

{% block content %}
<div class="page-header">
    <h1>{{ recording.title }}</h1>
    <p>Детали записи</p>
</div>

<div class="grid grid-2">
    <div class="card">
        <div class="card-header">
            <h3>Информация</h3>
        </div>
        <div class="card-body">
            <div style="display: flex; flex-direction: column; gap: 1rem;">
                <div>
                    <div style="color: var(--text-secondary); font-size: 0.875rem; margin-bottom: 0.25rem;">Статус</div>
                    <div><span class="status-badge status-{{ recording.status }}">{{ recording.get_status_display }}</span></div>
                </div>
                <div>
                    <div style="color: var(--text-secondary); font-size: 0.875rem; margin-bottom: 0.25rem;">Модель Whisper</div>
                    <div><span class="badge badge-primary">{{ recording.get_whisper_model_display }}</span></div>
                </div>
                <div>
                    <div style="color: var(--text-secondary); font-size: 0.875rem; margin-bottom: 0.25rem;">Дата создания</div>
                    <div style="color: var(--text-primary);">{{ recording.created_at|date:"d.m.Y H:i" }}</div>
                </div>
                {% if recording.processed_at %}
                <div>
                    <div style="color: var(--text-secondary); font-size: 0.875rem; margin-bottom: 0.25rem;">Обработано</div>
                    <div style="color: var(--text-primary);">{{ recording.processed_at|date:"d.m.Y H:i" }}</div>
                </div>
                {% endif %}
                {% if recording.audio_file %}
                <div>
                    <div style="color: var(--text-secondary); font-size: 0.875rem; margin-bottom: 0.25rem;">Файл</div>
                    <div style="color: var(--text-primary);">{{ recording.get_file_name }} ({{ recording.get_file_size }} MB)</div>
                </div>
                {% endif %}
            </div>
            
            <div style="margin-top: 1.5rem; display: flex; flex-direction: column; gap: 0.75rem;">
                {% if recording.audio_file %}
                <a href="{{ recording.audio_file.url }}" download class="button button-primary">Скачать аудио</a>
                {% endif %}
                
                {% if recording.status == 'uploaded' %}
                <form method="post" action="{% url 'transcribe_recording' recording.pk %}">
                    {% csrf_token %}
                    <button type="submit" class="button button-primary" style="width: 100%;">
                        Начать распознавание речи
                    </button>
                </form>
                {% endif %}
                
                <a href="{% url 'recordings_list' %}" class="button button-secondary">Назад к списку</a>
            </div>
        </div>
    </div>
    
    {% if recording.audio_file %}
    <div class="card">
        <div class="card-header">
            <h3>Аудио</h3>
        </div>
        <div class="card-body">
            <audio controls style="width: 100%; border-radius: var(--radius-sm);">
                <source src="{{ recording.audio_file.url }}" type="audio/webm">
                Ваш браузер не поддерживает аудио элемент.
            </audio>
        </div>
    </div>
    {% endif %}
</div>

{% if recording.transcription %}
<div class="card">
    <div class="card-header">
        <h3>Транскрипция</h3>
    </div>
    <div class="card-body">
        <div style="background: var(--bg-secondary); padding: 1.5rem; border-radius: var(--radius-sm); border: 1px solid var(--border); white-space: pre-wrap; line-height: 1.8; color: var(--text-primary);">
            {{ recording.transcription }}
        </div>
    </div>
</div>
{% elif recording.status == 'processing' %}
<div class="card">
    <div class="card-header">
        <h3>Транскрипция</h3>
    </div>
    <div class="card-body">
        <div class="alert alert-info">
            <span>⏳</span>
            Запись обрабатывается. Транскрипция появится здесь после завершения обработки.
        </div>
    </div>
</div>
{% elif recording.status == 'failed' %}
<div class="card">
    <div class="card-header">
        <h3>Транскрипция</h3>
    </div>
    <div class="card-body">
        <div class="alert alert-error">
            <span>❌</span>
            Ошибка при обработке записи. {% if recording.error_message %}{{ recording.error_message }}{% endif %}
        </div>
    </div>
</div>
{% elif recording.status == 'uploaded' and not recording.transcription %}
<div class="card">
    <div class="card-header">
        <h3>Транскрипция</h3>
    </div>
    <div class="card-body">
        <div class="alert alert-info">
            <span>ℹ️</span>
            Транскрипция еще не создана. Используйте кнопку "Начать распознавание речи" выше для запуска обработки.
        </div>
    </div>
</div>
{% endif %}
{% endblock %}
