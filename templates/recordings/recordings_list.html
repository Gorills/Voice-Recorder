{% extends 'base.html' %}

{% block title %}Записи{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Все записи</h1>
    <p>Управляйте своими аудио записями</p>
</div>

<div class="card">
    <div class="card-header">
        <h3>Записи</h3>
        <a href="{% url 'dashboard' %}" class="button button-secondary" style="padding: 0.625rem 1rem; font-size: 0.875rem;">Назад к дашборду</a>
    </div>
    
    <div class="card-body">
        {% if page_obj %}
            <div class="table-container">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Название</th>
                            <th>Модель</th>
                            <th>Длительность</th>
                            <th>Статус</th>
                            <th>Дата</th>
                            <th>Действия</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for recording in page_obj %}
                        <tr>
                            <td>
                                <strong>{{ recording.title }}</strong>
                                {% if recording.audio_file %}
                                    <br><span class="text-muted">{{ recording.get_file_name }} ({{ recording.get_file_size }} MB)</span>
                                {% endif %}
                            </td>
                            <td><span class="badge badge-primary">{{ recording.get_whisper_model_display }}</span></td>
                            <td>
                                {% if recording.duration %}
                                    {{ recording.duration|floatformat:0 }} сек
                                {% else %}
                                    <span class="text-muted">—</span>
                                {% endif %}
                            </td>
                            <td><span class="status-badge status-{{ recording.status }}">{{ recording.get_status_display }}</span></td>
                            <td>{{ recording.created_at|date:"d.m.Y H:i" }}</td>
                            <td>
                                <div class="action-buttons" style="display: flex; gap: 0.5rem; align-items: center; flex-wrap: wrap;">
                                    <a href="{% url 'recording_detail' recording.pk %}" class="button-icon-small button-icon-view" title="Просмотр" data-recording-id="{{ recording.pk }}">
                                        <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                        </svg>
                                    </a>
                                    {% if recording.status == 'processing' %}
                                    <button class="button-icon-small button-icon-cancel" title="Остановить обработку" data-recording-id="{{ recording.pk }}" data-recording-title="{{ recording.title }}">
                                        <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 10a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1h-4a1 1 0 01-1-1v-4z"></path>
                                        </svg>
                                    </button>
                                    {% else %}
                                    <button class="button-icon-small button-icon-transcribe" title="Распознать речь" data-recording-id="{{ recording.pk }}" data-recording-title="{{ recording.title }}">
                                        <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path>
                                        </svg>
                                    </button>
                                    {% endif %}
                                    <button class="button-icon-small button-icon-delete" title="Удалить" data-recording-id="{{ recording.pk }}" data-recording-title="{{ recording.title }}">
                                        <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                        </svg>
                                    </button>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            
            {% if is_paginated %}
                <div style="margin-top: 2rem; display: flex; justify-content: center; gap: 0.5rem;">
                    {% if page_obj.has_previous %}
                        <a href="?page={{ page_obj.previous_page_number }}" class="button button-secondary">Назад</a>
                    {% endif %}
                    
                    <span style="padding: 0.75rem 1rem; color: var(--text-secondary);">Страница {{ page_obj.number }} из {{ page_obj.paginator.num_pages }}</span>
                    
                    {% if page_obj.has_next %}
                        <a href="?page={{ page_obj.next_page_number }}" class="button button-secondary">Вперед</a>
                    {% endif %}
                </div>
            {% endif %}
        {% else %}
            <div class="alert alert-info">
                <span>ℹ️</span>
                У вас пока нет записей. <a href="{% url 'dashboard' %}" style="color: var(--accent);">Перейдите на дашборд</a> для создания первой записи.
            </div>
        {% endif %}
    </div>
</div>

<!-- Modal for Whisper Model Selection -->
<div id="whisper-model-modal" class="modal" style="display: none;">
    <div class="modal-overlay"></div>
    <div class="modal-content">
        <div class="modal-header">
            <h3>Выберите модель Whisper</h3>
            <button class="modal-close" id="modal-close-btn">&times;</button>
        </div>
        <div class="modal-body">
            <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">Выберите модель для распознавания речи:</p>
            <div class="modal-form-group">
                <label class="form-label">Модель Whisper</label>
                <select id="modal-whisper-model-select" class="form-select">
                    <option value="tiny">Tiny - Самая быстрая</option>
                    <option value="base" selected>Base - Баланс (рекомендуется)</option>
                    <option value="small">Small - Хорошее качество</option>
                    <option value="medium">Medium - Высокое качество</option>
                    <option value="large">Large - Наилучшее качество</option>
                </select>
                <small class="form-text text-muted" style="display: block; margin-top: 0.5rem;">Большие модели дают лучшее качество, но работают медленнее.</small>
            </div>
        </div>
        <div class="modal-footer">
            <button class="button button-secondary" id="modal-cancel-btn">Отмена</button>
            <button class="button button-primary" id="modal-confirm-btn">Запустить распознавание</button>
        </div>
    </div>
</div>
{% endblock %}
